@model iTest.Web.Areas.Admin.Models.AdminTestViewModel


<h2>New Test</h2>
<div class="row">
    <form method="post">
        <div asp-validation-summary="All" class="text-danger"></div>
        <div class="form-group col-md-6">
            <label asp-for="Name"></label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        <div class="form-group col-md-4">
            <label asp-for="RequestedTime"></label>
            <input asp-for="RequestedTime" class="form-control" />
            <span asp-validation-for="RequestedTime" class="text-danger"></span>
        </div>
        <div class="form-group col-md-2">
            <label asp-for="Category">Category</label>
            <select asp-for="Category" asp-items="Model.Categories" class="form-control"></select>
            <span asp-validation-for="Category" class="text-danger"></span>
        </div>
        <div class="col-md-12">
            <div class="container">
                <div class="row">
                    <h3 class="col-md-6">Add questions to your Test</h3>
                    <button id="add-question" class="btn btn-success pull-right" type="button">Add Question</button>
                </div>

                <div class="row">
                    <div class="well">




                        @{
                            if (Model.Questions != null && Model.Questions.Count != 0)
                            {
                                for (int q = 0; q < Model.Questions.Count; q++)
                                {
                                    <div id="question-@q" class="question-container1 panel panel-default">
                                        <button class="delete-question btn btn-danger btn-xs pull-right" type="button">
                                            <span class="glyphicon glyphicon-remove"></span>
                                        </button>
                                        <a href="#collapse-@q" data-toggle="collapse" data-parent="#accordion">
                                            <div class="panel-heading">
                                                <h4 class="panel-title">Question @string.Format("{0}", q + 1)</h4>
                                            </div>
                                        </a>
                                        <div id="collapse-@q" class="panel-collapse collapse">
                                            <div class="panel-body">
                                                <div class="question-description">
                                                    <h3>Description</h3>
                                                    <input type="hidden" id="@string.Format("Questions_{0}__DescriptionPlainText", q)" name="Questions[@q].DescriptionPlainText" value="" />
                                                    <textarea id="@string.Format("Questions_{0}__Description", q)" name="Questions[@q].Body" class="summernote form-control">@Model.Questions[q].Description</textarea>
                                                    <span asp-validation-for="Questions[@q].DescriptionPlainText" class="text-danger"></span>
                                                </div>
                                                <div class="answers-container">
                                                    @if (Model.Questions[q].Answers != null)
                                                    {
                                                        for (int a = 0; a < Model.Questions[q].Answers.Count; a++)
                                                        {
                                                            <div id="question-@q-answer-@a" class="answer-container">
                                                                <div class="row answer-header">
                                                                    <div class="col">
                                                                        <h3>Answer @string.Format("{0}", a + 1)</h3>
                                                                    </div>
                                                                    <div class="col">
                                                                        <button class="delete-answer btn btn-danger btn-xs pull-right" type="button">
                                                                            <span class="glyphicon glyphicon-remove"></span>
                                                                        </button>
                                                                        <label class="btn btn-success pull-right">
                                                                            @if (Model.Questions[q].Answers[a].IsCorrect)
                                                                            {
                                                                                <input id="@string.Format("Questions_{0}__Answers_{1}__IsCorrect", q, a)" name="radio-@q" class="answer-is-correct" type="radio" value="true" autocomplete="off" checked>
                                                                            }
                                                                            else
                                                                            {
                                                                                <input id="@string.Format("Questions_{0}__Answers_{1}__IsCorrect", q, a)" name="radio-@q" class="answer-is-correct" type="radio" value="true" autocomplete="off">
                                                                            }
                                                                            <span class="glyphicon glyphicon-ok"></span>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                                <input type="hidden" id="@string.Format("Questions_{0}__Answers_{1}__DescriptionPlainText", q, a)" name="Questions[@q].Answers[@a].DescriptionPlainText" value="" />
                                                                <textarea id="@string.Format("Questions_{0}__Answers_{1}__Content", q, a)" name="Questions[@q].Answers[@a].Description" class="answer-content summernote form-control">@Model.Questions[q].Answers[a].Description</textarea>
                                                                <span asp-validation-for="Questions[q].Answers[a].Description" class="text-danger"></span>
                                                            </div>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <div class="no-answers">
                                                            <h4 class="w-100 p-3">You need to add Answers to your Question</h4>
                                                        </div>
                                                    }
                                                </div>
                                                <span asp-validation-for="Questions[q].Answers" class="text-danger"></span>
                                            </div>
                                            <div class="panel-body">
                                                <button class="add-answer btn btn-default pull-right" name="collapse-@q" type="button">Add Answer</button>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="question-container1">
                                    <h4 class="w-100 p-3">You need to add Questions to your Test</h4>
                                </div>
                            }
                        }




                    </div>
                    <div class="pull-right">
                        <button name="IsPublished" class="create-test btn btn-default" type="submit" value="false">Save as Draft</button>
                        <button name="IsPublished" class="create-test btn btn-default" type="submit" value="true">Publish</button>
                    </div>

                    <span asp-validation-for="Questions" class="text-danger"></span>
                </div>
            </div>
        </div>
    </form>
</div>
<script>
    $('.summernote').summernote({
        placeholder: 'Hello stand alone ui',
        tabsize: 2,
        height: 200,
        toolbar: [
            ['style', ['bold', 'italic', 'underline', 'clear']],
            ['font', ['strikethrough', 'superscript', 'subscript']],
            ['fontsize', ['fontsize']],
            ['para', ['ul', 'ol', 'paragraph']]
        ],
        disableResizeEditor: true
    });
</script>
<script src="js/create-test.js"></script>
<script>
    $(function () {
    var questionFrame =
        ` <div id="question-{{q_id}}" class="question-container panel panel-default">

     <button class="collapseBtn question btn btn-success btn-sm pull-right" href="#collapse-{{q_id}}" data-toggle="collapse" type="button">
         <span class="changeIcon glyphicon glyphicon-plus"></span>
     </button>
     <button class="delete-question btn btn-danger btn-sm pull-right" type="button">
         <span class="glyphicon glyphicon-trash"></span>
     </button>
     <button class="edit-question btn btn-info btn-sm pull-right" type="button">
         <span class="glyphicon glyphicon-pencil"></span>
     </button>
     <div>
         <a class="panel-heading" href="#collapse-{{q_id}}" data-toggle="collapse">
             <h4 class="panel-title">
                 Question {{q_number}}
             </h4>
         </a>
     </div>

     <div id="collapse-{{q_id}}" class="panel-collapse collapse">
         <div class="panel-body">
             <div class="question-description">
                 <h4>Description</h4>
                 <input type="hidden" id="Questions_{{q_id}}__Description" name="Questions[{{q_id}}].Description" value="" />
                 <textarea id="Questions_{{q_id}}__Description" name="Questions[{{q_id}}].Description" class="summernote form-control"></textarea>



             </div>

             <div class="answers-container">

                 <div id="question-{{q_id}}-answer-0" class="answer-container">
                     <div class="answer-header">
                         <button class="delete-answer btn btn-danger btn-xs pull-right" type="button">
                             <span class="glyphicon glyphicon-trash"></span>
                         </button>
                         <label class="btn btn-success btn-xs pull-right">
                             <input id="Questions_{{q_id}}__Answers_0__IsCorrect" name="radio-{{q_id}}" class="answer-is-correct" type="radio" value="true" autocomplete="off" checked />
                             <span class="glyphicon glyphicon-ok">Correct</span>
                         </label>
                     </div>
                     <input type="hidden" id="Questions_{{q_id}}__Answers_0__DescriptionPlainText" name="Questions[{{q_id}}].Answers[0].DescriptionPlainText" value="" />
                     <h4>Answer 1</h4>
                     <textarea id="Questions_{{q_id}}__Answers_0__Description" name="Questions[{{q_id}}].Answers[0].Description" class="answer-content summernote form-control"></textarea>
                 </div>

                 <div id="question-{{q_id}}-answer-1" class="answer-container">
                     <div class="answer-header">
                         <button class="delete-answer btn btn-danger btn-xs pull-right" type="button">
                             <span class="glyphicon glyphicon-trash"></span>
                         </button>
                         <label class="btn btn-success btn-xs pull-right">
                             <input id="Questions_{{q_id}}__Answers_1__IsCorrect" name="radio-{{q_id}}" class="answer-is-correct" type="radio" value="true" autocomplete="off" checked />
                             <span class="glyphicon glyphicon-ok">Correct</span>
                         </label>
                     </div>
                     <input type="hidden" id="Questions_{{q_id}}__Answers_1__DescriptionPlainText" name="Questions[{{q_id}}].Answers[1].DescriptionPlainText" value="" />
                     <h4>Answer 2</h4>
                     <textarea id="Questions_{{q_id}}__Answers_1__Description" name="Questions[{{q_id}}].Answers[1].Description" class="answer-content summernote form-control"></textarea>
                 </div>

                 <div id="question-{{q_id}}-answer-2" class="answer-container">
                     <div class="answer-header">
                         <button class="delete-answer btn btn-danger btn-xs pull-right" type="button">
                             <span class="glyphicon glyphicon-trash"></span>
                         </button>
                         <label class="btn btn-success btn-xs pull-right">
                             <input id="Questions_{{q_id}}__Answers_2__IsCorrect" name="radio-{{q_id}}" class="answer-is-correct" type="radio" value="true" autocomplete="off" checked />
                             <span class="glyphicon glyphicon-ok">Correct</span>
                         </label>
                     </div>
                     <input type="hidden" id="Questions_{{q_id}}__Answers_2__DescriptionPlainText" name="Questions[{{q_id}}].Answers[2].DescriptionPlainText" value="" />
                     <h4>Answer 3</h4>
                     <textarea id="Questions_{{q_id}}__Answers_2__Description" name="Questions[{{q_id}}].Answers[2].Description" class="answer-content summernote form-control"></textarea>
                 </div>
             </div>
             <div class="panel-body">
                 <button class="add-answer btn btn-default pull-right" name="collapse-{{q_id}}" type="button">Add Answer</button>
             </div>
         </div>
     </div>`;

    var answerFrame =
        `<div class="answers-container">

                 <div id="question-{{q_id}}-answer-{{a_id}}" class="answer-container">
                     <div class="answer-header">
                         <button class="delete-answer btn btn-danger btn-xs pull-right" type="button">
                             <span class="glyphicon glyphicon-trash"></span>
                         </button>
                         <label class="btn btn-success btn-xs pull-right">
                             <input id="Questions_{{q_id}}__Answers_{{a_id}}__IsCorrect" name="radio-{{q_id}}" class="answer-is-correct" type="radio" value="true" autocomplete="off" checked />
                             <span class="glyphicon glyphicon-ok">Correct</span>
                         </label>
                     </div>
                     <input type="hidden" id="Questions_{{q_id}}__Answers_{{a_id}}__DescriptionPlainText" name="Questions[{{q_id}}].Answers[{{a_id}}].DescriptionPlainText" value="" />
                     <h4>Answer {{a_number}}</h4>
                     <textarea id="Questions_{{q_id}}__Answers_{{a_id}}__Description" name="Questions[{{q_id}}].Answers[{{a_id}}].Description" class="answer-content summernote form-control"></textarea>
                 </div>
        </div>`;

    var questionSummernoteConfig = {
        placeholder: 'Add your description here...',
        height: 200,
        toolbar: [
            ['style', ['bold', 'italic', 'underline', 'clear']],
            ['font', ['strikethrough', 'superscript', 'subscript']],
            ['fontsize', ['fontsize']],
            ['para', ['ul', 'ol', 'paragraph']]
        ],
        disableResizeEditor: true
    };

    var answerSummernoteConfig = {
        height: 200,
        toolbar: [
            ['style', ['bold', 'italic', 'underline', 'clear']],
            ['font', ['strikethrough', 'superscript', 'subscript']],
            ['fontsize', ['fontsize']],
            ['para', ['ul', 'ol', 'paragraph']]
        ],
        disableResizeEditor: true
    };

    //functions
    var initializeSummernote = function () {
        $('.summernote')
            .toArray()
            .forEach(function (textarea) {
                var text = textarea.textContent;
                $(textarea).summernote(answerSummernoteConfig);
                textarea.textContent = text;
            });
    };

    var radioButtonClick = function (questionNumber) {
        var answerRadioButtons = $(`#question-${questionNumber} .answers-container .answer-container input`)
            .filter(function () {
                return this.type === 'radio';
            });

        var hasCheckedRadioButton = answerRadioButtons
            .is(function () {
                return $(this).prop('checked') === true;
            });

        if (!hasCheckedRadioButton) {
            answerRadioButtons.first().prop('checked', true);
        }
        };

        var containerLen = $('.question-container1').length;

        var addQuestionEvent = $('#add-question').on('click',
            function() {
                console.log('irina eeeee');
                var questionHtml = questionFrame
                    .replace(/\{\{\q_id\}\}/g, containerLen - 1)
                    .replace(/\{\{\q_number\}\}/g, containerLen);
                var question = $(questionHtml);
                if (containerLen === 0) {
                    $('.question-container1')
                        .html(question);
                }
                else {
                    $('.question-container1')
                        .append(question);
                }
                containerLen++;
            });

    });
</script>